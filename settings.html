<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>群組設定 (含重新命名功能)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Modal 動畫效果 */
        .slide-up-enter-active, .slide-up-leave-active { transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .slide-up-enter-from, .slide-up-leave-to { transform: translateY(100%); opacity: 0; }
        
        .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body { background-color: #111827 !important; color: #ffffff !important; }
            #app { background-color: #111827 !important; }
            header { background-color: #1f2937 !important; }
            .bg-gray-50 { background-color: #1f2937 !important; }
            .bg-white { background-color: #374151 !important; }
            .text-slate-900 { color: #ffffff !important; }
            .text-slate-800 { color: #e5e7eb !important; }
            .text-slate-700 { color: #d1d5db !important; }
            .text-gray-500 { color: #d1d5db !important; }
            .text-gray-400 { color: #9ca3af !important; }
            .text-gray-300 { color: #9ca3af !important; }
            .text-red-500 { color: #f87171 !important; }
            .border-gray-100 { border-color: #4b5563 !important; }
            .border-gray-200 { border-color: #4b5563 !important; }
            .bg-gray-100 { background-color: #374151 !important; }
            .bg-red-50 { background-color: #7f1d1d !important; }
            .hover\:bg-gray-100:hover { background-color: #4b5563 !important; }
            .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.5) !important; }
            .shadow-\[0_-2px_10px_rgba\(0\,0\,0\,0\.05\)\] { box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3) !important; }
            .bg-slate-900 { background-color: #3b82f6 !important; }
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-900 h-screen overflow-hidden">

    <div id="app" class="max-w-md mx-auto h-full flex flex-col relative">

        <header class="px-4 py-3 flex items-center relative bg-gray-50 z-10 shrink-0">
            <div class="w-10 h-10"></div>
            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                <h1 class="text-lg font-black text-slate-900">設定</h1>
                <h2 class="text-xs font-medium text-gray-500">{{ currentGroupName }}</h2>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto px-4 py-4 hide-scrollbar space-y-4 pb-28">
            
            <div v-for="(group, gIndex) in settingsGroups" :key="gIndex" class="space-y-3">
                <h2 v-if="group.groupTitle" class="text-xs font-bold text-gray-400 mb-1 pl-2 tracking-wide uppercase">
                    {{ group.groupTitle }}
                </h2>

                <div class="space-y-2">
                    <div v-for="(item, iIndex) in group.items" :key="iIndex"
                         @click="handleAction(item)"
                         class="bg-white rounded-2xl shadow-sm flex items-center justify-between p-4 active:bg-gray-50 transition cursor-pointer">
                        
                        <div class="flex items-center gap-3.5 flex-1 min-w-0">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0" :class="item.isDestructive ? 'bg-red-50' : 'bg-gray-100'">
                                <i :class="[item.icon, item.isDestructive ? 'text-red-500' : 'text-slate-700']" class="text-lg"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <span class="font-bold text-[15px] block" :class="item.isDestructive ? 'text-red-500' : 'text-slate-900'">
                                    {{ item.title }}
                                </span>
                                <span v-if="item.value && !item.isMembers" class="text-xs text-gray-500 mt-0.5 block">
                                    {{ item.value }}
                                </span>
                            </div>
                        </div>

                        <div class="flex items-center gap-3 shrink-0">
                            <div v-if="item.isMembers" class="flex -space-x-2">
                                <img v-for="seed in item.avatars" :src="`https://api.dicebear.com/7.x/bottts/svg?seed=${seed}`" 
                                     class="w-7 h-7 rounded-full border-2 border-white bg-gray-200 shadow-sm">
                            </div>
                            <i class="fas fa-chevron-right text-xs text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <transition name="fade">
            <div v-if="showRenameModal" class="fixed inset-0 bg-black/40 backdrop-blur-[2px] z-40" @click="showRenameModal = false"></div>
        </transition>

        <transition name="slide-up">
            <div v-if="showRenameModal" class="fixed bottom-0 left-0 right-0 sm:inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 pointer-events-none">
                <div class="bg-white w-full max-w-[400px] rounded-t-[2rem] sm:rounded-[2rem] p-6 pt-8 shadow-2xl relative pointer-events-auto" @click.stop>
                    
                    <div class="flex justify-between items-start mb-8">
                        <h2 class="text-[28px] font-black text-slate-900 leading-tight break-all pr-4">{{ currentGroupName }}</h2>
                        <button @click="showRenameModal = false" class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-slate-500 hover:bg-gray-200 transition shrink-0">
                            <i class="fas fa-times text-lg"></i>
                        </button>
                    </div>

                    <div class="mb-10">
                        <label class="block text-sm font-bold text-gray-500 mb-2">新群組名稱</label>
                        <div class="relative">
                            <input ref="nameInputRef"
                                   v-model="newName"
                                   type="text"
                                   class="w-full text-xl font-bold text-slate-900 py-3 bg-transparent outline-none border-b-[3px] border-teal-500 focus:border-teal-600 transition placeholder-gray-300 pr-10"
                                   placeholder="輸入名稱">
                            
                            <button v-if="newName" @click="newName = ''; nameInputRef?.focus()" class="absolute right-0 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center text-gray-300 hover:text-gray-500 transition">
                                <i class="fas fa-times-circle"></i>
                            </button>
                        </div>
                    </div>

                    <button @click="saveName" :disabled="!newName" 
                            class="w-full bg-teal-500 hover:bg-teal-600 disabled:bg-gray-200 disabled:text-gray-400 text-white font-bold py-4 rounded-[2rem] text-lg transition mb-safe">
                        儲存
                    </button>

                </div>
            </div>
        </transition>

        <!-- 浮動新增按鈕 -->
        <div class="absolute bottom-24 right-6 z-40">
            <a href="record.html" class="bg-slate-900 text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center text-xl hover:scale-110 transition active:scale-95">
                <i class="fas fa-plus"></i>
            </a>
        </div>

        <!-- 底部工具列 -->
        <div class="absolute bottom-0 left-0 right-0 bg-white z-30 safe-area-bottom shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
            <div class="max-w-md mx-auto px-2 py-2 flex items-center justify-around">
                <a href="overview.html" class="flex flex-col items-center justify-center py-2 px-3 rounded-xl transition active:bg-gray-50 flex-1">
                    <i class="fas fa-home text-lg mb-1 text-gray-400"></i>
                    <span class="text-xs font-bold text-gray-400">總覽</span>
                </a>
                
                <a href="records.html" class="flex flex-col items-center justify-center py-2 px-3 rounded-xl transition active:bg-gray-50 flex-1">
                    <i class="fas fa-list text-lg mb-1 text-gray-400"></i>
                    <span class="text-xs font-bold text-gray-400">紀錄</span>
                </a>
                
                <a href="statistics.html" class="flex flex-col items-center justify-center py-2 px-3 rounded-xl transition active:bg-gray-50 flex-1">
                    <i class="fas fa-chart-pie text-lg mb-1 text-gray-400"></i>
                    <span class="text-xs font-bold text-gray-400">統計</span>
                </a>
                
                <a href="settings.html" class="flex flex-col items-center justify-center py-2 px-3 rounded-xl transition active:bg-gray-50 flex-1">
                    <i class="fas fa-cog text-lg mb-1 text-slate-900"></i>
                    <span class="text-xs font-bold text-slate-900">設定</span>
                </a>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, nextTick } = Vue

        createApp({
            setup() {
                // 狀態管理
                const currentGroupName = ref('東京滑雪')
                const showRenameModal = ref(false)
                const newName = ref('')
                const nameInputRef = ref(null)

                // 列表資料 (加上 action 屬性以便識別)
                const settingsGroups = ref([
                    {
                        groupTitle: '群組資訊',
                        items: [
                            { icon: 'fas fa-user-group', title: '成員', isMembers: true, avatars: ['Han', 'Cat', 'Dobby'], action: 'members' },
                            { icon: 'fas fa-coins', title: '群組幣別', value: 'TWD', action: 'currency' },
                            { icon: 'fas fa-layer-group', title: '類別設定', value: '7', action: 'category' },
                        ]
                    },
                    {
                        groupTitle: '個人偏好',
                        items: [
                            { icon: 'fas fa-globe', title: '預設幣別', value: 'TWD', action: 'default_currency' },
                            { icon: 'fas fa-calculator', title: '預設匯率', value: '最後使用', action: 'rate' },
                        ]
                    },
                    {
                        groupTitle: '進階管理',
                        items: [
                            // 這裡設定 action: 'rename' 來觸發 Modal
                            { icon: 'fas fa-pen', title: '重新命名群組', action: 'rename' },
                            { icon: 'far fa-trash-alt', title: '刪除群組', isDestructive: true, action: 'delete' },
                        ]
                    }
                ])

                // 統一處理列表點擊
                const handleAction = (item) => {
                    if (item.action === 'rename') {
                        // 1. 預填入目前的名稱
                        newName.value = currentGroupName.value
                        // 2. 開啟 Modal
                        showRenameModal.value = true
                        // 3. 自動聚焦輸入框
                        nextTick(() => {
                            nameInputRef.value?.focus()
                        })
                    } else if (item.action === 'category') {
                        // 跳轉到類別設定頁面
                        window.location.href = 'category.html'
                    } else if (item.action === 'delete') {
                        if(confirm('確定要刪除群組嗎？此操作無法復原。')) {
                            alert('刪除功能執行中...')
                        }
                    } else {
                        console.log('點擊了:', item.title)
                    }
                }

                // 儲存名稱邏輯
                const saveName = () => {
                    if (!newName.value) return
                    currentGroupName.value = newName.value
                    showRenameModal.value = false
                    // 這裡可以加入 API 呼叫程式碼
                }

                return { 
                    currentGroupName, 
                    settingsGroups, 
                    showRenameModal, 
                    newName, 
                    nameInputRef,
                    handleAction,
                    saveName
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
